# ML Server Configuration
# Agentless Kubernetes Cost Optimization

ml_server:
  host: "0.0.0.0"
  port: 8001
  workers: 4
  log_level: "INFO"

database:
  host: "localhost"
  port: 5432
  name: "ml_server"
  user: "ml_server"
  password: "ml_server_password"
  pool_size: 10
  max_overflow: 20

redis:
  host: "localhost"
  port: 6379
  db: 0
  cache_ttl_seconds: 3600  # 1 hour for Spot Advisor data
  pool_size: 10

aws:
  region: "us-east-1"
  spot_advisor_url: "https://spot-bid-advisor.s3.amazonaws.com/spot-advisor-data.json"

models:
  upload_dir: "/opt/ml-server/models/uploaded"
  max_file_size_mb: 500
  allow_training: false  # Inference-only
  auto_reload: true

decision_engines:
  upload_dir: "/opt/ml-server/decision_engine/uploaded"
  active_engines:
    # Core CAST AI compatible engines
    spot_optimizer: "spot_optimizer_v1"
    bin_packing: "bin_packing_v1"
    rightsizing: "rightsizing_v1"
    scheduler: "scheduler_v1"
    ghost_probe: "ghost_probe_v1"
    volume_cleanup: "volume_cleanup_v1"
    network_optimizer: "network_optimizer_v1"
    oomkilled_remediation: "oomkilled_v1"
    # Advanced feature engines (can be toggled via frontend)
    ipv4_cost_tracker: "ipv4_tracker_v1"
    image_bloat_analyzer: "image_bloat_v1"
    shadow_it_tracker: "shadow_it_v1"
    noisy_neighbor_detector: "noisy_neighbor_v1"

  # Feature toggles (enable/disable via frontend)
  feature_toggles:
    ipv4_cost_tracking:
      enabled: true
      description: "Track IPv4 public IP costs (AWS charges $0.005/hr since Feb 2024)"
      auto_scan_interval_hours: 24
    image_bloat_analysis:
      enabled: true
      description: "Analyze container image sizes and calculate bloat tax"
      auto_scan_interval_hours: 168  # Weekly
      bloat_threshold_mb: 500
    shadow_it_detection:
      enabled: true
      description: "Detect AWS resources not managed by Kubernetes"
      auto_scan_interval_hours: 24
      min_age_days: 7
    noisy_neighbor_detection:
      enabled: true
      description: "Detect pods causing excessive network traffic"
      auto_scan_interval_hours: 6
      bandwidth_outlier_multiplier: 10

gap_filler:
  enabled: true
  default_lookback_days: 15
  max_lookback_days: 90
  batch_size: 1000

model_refresh:
  auto_refresh_enabled: false
  schedule: "0 2 * * *"  # Daily at 2 AM UTC
  lookback_days: 7

pricing_data:
  fetch_parallelism: 5
  retry_attempts: 3
  retry_backoff_seconds: 2
